<!DOCTYPE html>
<html lang="gu">
<head>
    <meta charset="UTF-8">
    <title>ðŸ“· Scan AWB Numbers</title>
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body class="bg-light">
<div class="container mt-5">
    <h2 class="text-center mb-4">ðŸ“¦ Scan QR Codes (AWB Numbers)</h2>

    <div class="text-center mb-4">
        <button onclick="startScanner()" class="btn btn-success">Start Scanning</button>
        <button onclick="stopScanner()" class="btn btn-danger ms-2">Stop</button>
        <a href="{% url 'home' %}" class="btn btn-secondary ms-2">Go to Home</a>
    </div>

    <div id="reader" style="width: 400px; margin: auto;"></div>

    <form method="POST" action="{% url 'save_scan' %}">
        {% csrf_token %}
        <input type="hidden" name="scanned_data" id="scanned_data_input">
        <div class="mt-4 text-center">
            <button type="submit" class="btn btn-primary">Compare & View Result</button>
        </div>
    </form>

    <div class="mt-4 text-center">
        <h5>ðŸ“‹ Scanned AWB Numbers:</h5>
        <ul id="scanned_list" class="list-group mt-2" style="max-height: 200px; overflow-y: auto;"></ul>
    </div>
</div>

<script>
    let scannedAWBs = [];

    function startScanner() {
        const html5QrCode = new Html5Qrcode("reader");
        html5QrCode.start(
            { facingMode: "environment" },
            {
                fps: 10,
                qrbox: 250
            },
            qrCodeMessage => {
                if (!scannedAWBs.includes(qrCodeMessage)) {
                    scannedAWBs.push(qrCodeMessage);
                    document.getElementById("scanned_list").innerHTML += `<li class="list-group-item">${qrCodeMessage}</li>`;
                    document.getElementById("scanned_data_input").value = scannedAWBs.join(",");
                }
            },
            errorMessage => {}
        ).catch(err => {
            console.error("Error:", err);
        });

        window.html5QrCode = html5QrCode;
    }

    function stopScanner() {
        if (window.html5QrCode) {
            window.html5QrCode.stop().then(() => {
                window.html5QrCode.clear();
            });
        }
    }
</script>
</body>
</html>
